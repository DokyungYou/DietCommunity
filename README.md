# 🍴다이어트 커뮤니티 서비스

본인의 식단과 섭취한 영양소를 기록하고, 다이어트에 관한 정보를 공유하는 커뮤니티 서비스
(정해진 기간: 11.13~ 12.15)

프로젝트 기능 및 설계
--

### 📌[회원인증]

### 회원가입(일반)
- **일반회원**
    - 이메일, 아이디 ,닉네임, 비밀번호를 입력받음
        - 이메일, 아이디, 닉네임의 경우 이미 사용중인 회원이 있다면 가입불가
        - 비밀번호는 입력받은 값을 암호화하여 데이터베이스에 저장

    - 회원 가입 시 role(권한)에 GENERAL 부여
    - 회원 가입 성공시 랜덤코드 혹은 인증전용토큰을 생성하여 redis에 저장 (데이터 유효기간을 같이 설정)
    - 입력한 이메일에 인증할 수 있는 링크와 함께 전송하고 회원은 해당 링크로 접속 시 인증을 할 수 있음
    - 인증성공 후 계정의 인증여부를 true로 수정, redis에 남아있는 인증코드를 삭제
- **관리자**

  - 이메일인증 과정까지는 일반회원가입과 동일
  - 2차인증까지 마쳐야 role(권한)에 ADMIN 부여 (2차인증 방식 미정)
  


### 로그인(일반) 
가입, 로그인 외의 모든 기능은 로그인을 후 발급한 토큰을 통해 인증, 인가 과정을 통과해야 이용가능

- 이메일 인증을 완료해야 해당 계정으로 로그인 가능
- 데이터베이스에 등록된 아이디, 비밀번호와 일치할 시 로그인가능
- 로그인할 경우 토큰발급 후 redis에 저장
    - accessToken
      - 탈취당하기 쉬운 특성상 유효기간을 짧게 설정 (시간 미정)
    - refreshToken
      - 만료된 accessToken의 재발급 요청에 사용됨 (시간 미정)

- 로그아웃
    - redis에 로그아웃한 계정의 토큰을 관리하는 저장소를 만든다. (블랙리스트)
    - 로그아웃시 redis 의 블랙리스트에 accessToken를 남은 유효기간만큼 설정하여 저장
    - 블랙리스트에 존재하는 토큰으로 인증 시도시 요청 거부


- 아이디 찾기
    - 회원가입 시에 인증에 사용되었던 이메일을 입력 시 아이디의 문자일부를 노출


- 비밀번호 찾기(재설정)
    - 가입시에 사용했던 아이디와 이메일 입력시 랜덤코드 혹은 인증전용토큰을 생성하여 데이터베이스에 저장 후 해당 이메일에 비밀번호를 수정할 수 있는 url을 전송
    - 해당 url로 접속하여 원하는 비밀번호를 입력하여 재설정

### [회원관련기능]
### 회원정보 조회
- 프로필 조회 
  - 닉네임, 간단한 소개글, 팔로잉, 팔로워수를 노출
      - 내 프로필 조회
      - 타 회원 프로필 조회 
        - 게시글, 댓글 등에 노출되는 타 회원의 아이디를 통해 접근하여 프로필 조회가능

### 회원정보 수정
- 본인의 회원정보만 수정가능
- 닉네임, 소개글, 비밀번호 수정 가능
- 기존 비밀번호를 입력해야 수정가능

### 회원탈퇴 
- 본인의 계정만 탈퇴가능
- 해당 계정의 상태를 UNREGISTERD 로 수정


### 내 활동 조회
   - 내가 작성한 게시글 목록
     - 작성날짜시간기준 최신순
     

   - 내가 작성한 댓글 목록 
     - 작성날짜시간기준 최신순


   - 내가 참여한 챌린지 목록
     - 참여날짜기준 최신순


   - 내가 참여 중인 채팅방 목록
     - 마지막 채팅메세지 전송날짜시간 기준 최신순

### 팔로잉

- 게시글, 댓글 등에 노출되는 특정회원의 아이디를 통해 팔로잉 신청

### 팔로잉, 팔로워 조회
해당하는 회원의 닉네임을 나열
   - 내가 팔로잉한 유저목록
   - 나를 팔로잉한 유저목록


### 내 목표 조회 및 수정
   - 섭취목표
     - 섭취 목표의 경우 하루에 최대 하나의 데이터만 생성 가능하며, 여러번 접근 시 기존데이터의 수정만 가능
       - 칼로리 (필수)
       - 탄수화물, 단백질, 지방 (필수) - % 로 입력받음
       - 식이섬유 (g)
       - 당류 (g)
       - 포화지방 (g)
       - 나트륨 (mg)
   - 최종 목표 체중
     - kg단위로 입력가능하며 수정만 가능




    
### 📌[일반 게시글 관련기능]
### 게시글 작성 & 수정
- 제목
  - X자이내의 문자로 제한
- 내용(텍스트) 
  - X자 이내의 문자로 제한
- 이미지
  - 게시글 하나에 최대 X개의 이미지 등록가능 (개수 미정)
  - 데이터베이스에 이미지url을 저장하고 실제 이미지파일은 S3버킷에 저장


    
### 게시글목록 조회
조건값들을 입력받아 오프셋 페이지네이션으로 구현

  - **게시글 일반조회**
    - 선택한 카테고리 내의 날짜시간기준으로 최신순으로 정렬됨 



  - **게시글 검색조회**

Elastic Search 을 검색엔진으로 사용하는 동시에 Elastic Search에서 제공하는 쿼리 클래스를 이용하여 아래 조건들에 맞는 게시글을 가져옴

   - 검색 입력내용 (제목 or 글작성자 닉네임)
     - 검색 내용대상(택1)
       - 제목 
       - 닉네임

     - 기간 (택1)
       - 전체
       - 특정기간(년, 월, 일로 설정)
         - ex) 시작) 2023.11.1 ~ 끝) 2023.11.13
     - 카테고리 (택1)
        - 전체
        - 특정 카테고리
     - 정렬 (택1)
       - 최신순 (등록날짜시간기준)
       - 조회순
       - 좋아요순

     - 검색 결과
       - 제목, 작성날짜시간, 댓글개수 ,조회수, 좋아요수, 작성자닉네임이 노출


###  게시글 상세조회
   - 제목, 내용(텍스트 + 이미지), 댓글수 ,댓글목록, 좋아요수, 조회수, 작성자닉네임
   - 해당 게시글에 본인이 좋아요를 등록했는지에 대한 여부
   - 댓글은 등록날짜시간 기준 오름차순으로 커서기반 페이지네이션 적용
### 댓글
   - 등록
     - 최대 X자 텍스트 등록가능
   - 삭제
     - 저장했던 내용은 수정불가하며 삭제 시 댓글상태컬럼을 deleted로 수정하여 조회시 노출되지 않도록 함
### 조회수
   - 사용자 id기반으로 조회수 카운트 (로그인한 회원만 게시글열람 가능)
### 좋아요
   - 게시글에 좋아요 등록 및 취소
   - 특정 게시글에 좋아요를 한 적 없다면 좋아요 데이터 생성, 이미 존재한다면 좋아요 데이터 삭제


### 📌[챌린지] 

### 챌린지 모집글
회원이 특정주제와 목표에 도전하는 내용의 모집글 등록 
- 등록 & 수정
  - 제목
    - 예시) x월x일까지 같이 키토식으로 감량해볼실 분??
  - 내용
  - 텍스트, 이미지(s3) - 제한기준은 일반게시글과 동일
  - 시작, 마감날짜 설정
  - 신청인원제한 수 설정
- 수정
  - 챌린지 시작날짜에 돌입 시 수정불가
  - 해당 챌린지에 참여신청한 회원이 존재 시 신청인원제한수를 줄일 수 없음

- 삭제
  - 해당 챌린지에 참여신청한 회원이 존재 시 삭제불가 

- 조회
    - 상태조건(택1)
      - 전체
      - 신청진행중
      - 신청마감 (챌린지시작날짜보다 지났거나 제한인원 수 도달 시 신청마감으로 간주)

  - 정렬조건(택1)  
       - 챌린지시작날짜 (오래된 순)
       - 등록날짜시간 (최신순)

- 참여
    - 챌린지 모집글에 들어가면 참여신청 할 수 있음
    - 선착순으로 참여가능하며 제한인원 도달 시 참여불가
      - 선착순 문제에 따른 동시성 문제 해결방안(미정)
    - 챌린지 시작날짜에 도달 시 신청 불가
    - 특정 챌린지에 참여시 참여한 다른 사용자의 체중, 섭취기록 등을 서로 열람가능
      - 챌린지 시작, 마감날짜동안 생성된 데이터만 열람 가능
### 챌린지 인증글
 챌린지 모집글 등록시 해당 챌린지에 참여한 회원들에게만 노출, 접근할 수 있는 채널 생성 (게시글 카테고리와 같이 관리)
- 등록
  - 참여한 챌린지 채널에 인증글을 남길 수 있음 (일반 게시글 테이블과 같이 관리)


- 조회
  - 조건 (택1)
    - 전체
    - 특정 참여자

  - 최신순 정렬 (등록날짜시간기준)


### 📌[체중]
- 기록
  하루에 한번 등록 가능 ( 날짜시간, 체중(kg)입력 )
- 수정
    - 가능
- 조회
- 내 체중기록 조회
    - 당일 기준 7일전까지의 데이터 (기본 조회)
    - 당일 기준 30일전까지의 데이터 (한 달 조회)
    - 시작, 끝 날짜를 입력받아서 조회
- 다른 사용자 조회
    - 같이 동일한 챌린지에 참여한 사용자의 기록만 조회가능(챌린지 기간동안의 기록만)


### 📌[섭취 다이어리]
         - 섭취다이어리 - 식품데이터 및 식단을 저장
         - 식품데이터  - db에 저장돼있는 개별의 식품데이터
         - 식단(식품데이터그룹) - 개별의 식품데이터를 모아놓은 그룹

- 식품 데이터 검색 
  
   - Elastic Search 을 검색엔진으로 사용
   - 서비스에서 기본으로 제공하는 식품데이터와 회원이 직접 저장한 식품데이터를 같이 검색할 수 있음

  - 식품데이터 상세조회
      - 해당 식품데이터가 가진 모든 컬럼데이터를 가져옴

- 섭취 다이어리 데이터
  - 추가 
    - 식품데이터 id, 중량, 섭취시간대를 입력받음
      1. 식품데이터 검색 후 데이터를 선택한다.
      2. 섭취한 중량과 시간을 선택하여 입력 ([중량] - g, [시간] - 아침, 점심, 저녁, 간식)
      3. 가져온 식품데이터의 영양소를 입력받은 중량으로 재계산한 섭취다이어리데이터를 생성하여 저장

  - 수정 & 삭제
    - 저장했던 데이터의 중량만 수정가능(같이 저장했던 중량을 토대로 새로 입력한 중량으로 영양소량 재계산)

            - 예시) 당근 100g (41kcal) -> 50g으로 수정시  (41kcal/100)*50 -> 20kcal로 수정, 나머지 영양소도 같은 과정으로 재계산

    


- ***섭취 다이어리 조회***

같은 챌린지에 참여중인 혹은 참여했던 타 회원의 기록 조회가능 (열람조건은 챌린지 기간내에 생성된 기록만 가능) 

  - 일별 총 섭취데이터 조회(날짜를 입력하여 아래 세 종류의 값을 한번에 노출)
    - 등록한 식품데이터들의 이름, 중량, kcal 노출
    - 목표 섭취영양소량
    - 하루 총 합 섭취영양소량


        
        예시)

       [ 
           "intake_date" : "2023-12-18",
           "intake_plan" : {
                                "calorie" : 1500,        
                                "carbohydrate(%) " : 50 ,
                                "sugars(g)" : ,
                                "dietary_fiber(g)" : ,
                                "protein(%) " : 20,
                                "fat(%) " : 30,
                                "saturated_fat(g)" : ,
                                "trans_fat(g)" : ,
                                "cholestrol(mg)" : ,
                                "sodium(mg)" :
                        },



        "daily_intake_nutrient_amount": {
                                "total_calorie" : 1500,        
                                "total_carbohydrate" :  ,
                                "total_sugars" : ,
                                "total_dietary_fiber" : ,
                                "total_protein" : ,
                                "total_fat" : ,
                                "total_saturated_fat" : ,
                                "total_trans_fat" : ,
                                "total_cholestrol" : ,
                                "total_sodium" :
                                        }
        "intake_diary" : [
                            {
                                "intake_diary_id" : 1,
                                "memberId" : 1,
                                "food_name" : "브로콜리",
                                "intake_amount" : 300
                                "kcal" : 500,
                                "meal_time" : "BREAKFAST"
                            },
                            {
                                "intake_diary_id" : 1,
                                "memberId" : 1,
                                "food_name" : "소고기 안심",
                                "intake_amount" : 100
                                "kcal": 500,
                                "meal_time" : "BREAKFAST"
                            },
                           {
                                "intake_diary_id" : 1,
                                "memberId" : 1,
                                "food_name" : "앵커버터(무가염)",
                                "intake_amount" : 150
                                "kcal": 500,
                                "meal_time" : "LUNCH"
                            }
                        ]
                    ]

  - 특정기간 조회
    - 시작날짜, 끝날짜
    - 등록한 식품데이터들의 이름, 중량, kcal 노출
    - 특정기간 동안의 평균 섭취영양소량




- **식단(식품그룹)**
  
 자주 먹는 조합이나 직접 만든 요리를 섭취 다이어리의 등록과 다른 사용자와의 공유를 용이하게 하기 위함

 - 식단(식품그룹) 등록
   - 이름
   - 공유여부 (false일 경우 다른 사용자가 해당 식단을 볼 수 없음)
   - 등록일자
   - 수정일자


 - 식단(식품그룹)
 - 추가 
   - db에 있는 식품데이터 검색 후 선택한 데이터와 중량를 함께 입력받아 재계산 데이터를 저장
 - 삭제
 - 수정 
   - 수정은 저장했던 중량만 수정 가능(영양소량은 수정된 중량에 맞게 재계산하여 수정)
   - 식품 데이터 자체를 수정하고 싶다면 삭제 후 새로 추가해야함
     - [ 설탕) 100g: 당류100g...] -> [ 설탕) 20g: 당류20g...]  (o)
     - [ 설탕) 100g: 당류100g...] -> [ 버터) 50g: 지방40g...]  (X)


- 식단 조회

  - 조회 조건(택1)
    - 전체
    - 내가 만든 식단
    - 북마크한 식단

   - 등록날짜시간 기준으로 최신순 정렬

### 📌[북마크]
  - 팔로잉한 사용자의 공유가능 상태인 식단을 북마크할 수 있다.
  - 식단을 북마크 시 자신의 섭취 다이어리에 적용가능
  - 해당 사용자가 식단내용을 수정 및 삭제, 공유불가로 수정해도 이미 다이어리에 적용한 데이터값은 수정X  (id값이 아닌 이름과 수치만 저장)


### 📌[식품 데이터 추가]

 - 섭취 다이어리 작성 시 원하는 식품데이터가 DB에 존재하지 않을 경우 직접 추가하여 사용
 - 공산품 혹은 브랜드가 있는 제품의 경우 제품 등록 시에 출처 정보를 같이 등록 (출처 링크 or 영양정보이미지 및 바코드 등)
    - 이 데이터는 후에 관리자가 검토 후 신뢰할만한 데이터라고 체크해야만 다른 사용자들이 식품데이터 검색 시에도  노출될 것임 (그렇지 않을 경우 등록한 사용자 본인에게만 노출되며 본인만 사용가능)
 - 검색 시에는 노출이 안돼도 자신을 팔로잉한 사용자가 자신의 식품그룹(신뢰X데이터가 적용된 그룹)을 조회, 북마크할때는 해당 데이터가 노출이 되며, 사용가능





### 📌[채팅]
   Websocket + Stomp & 외부 브로커(고민 중)

 - 특정사용자와 1대1 채팅


### 📌[알림]
server sent event 로 실시간 알림 구현
  - 자신이 작성한 게시글에 댓글이 등록될 때
  - 채팅 메세지가 올 때


### 📌[관리자]
- 식품데이터 관리
   사용자가 직접 추가한 식품데이터의 신뢰성을 체크 (통과여부 혹은 상태 컬럼)
- 게시글 관리
   - 일반게시글 카테고리 관리
     - 서비스 정책에 따라 수정 및 추가
     - 예시) 자유수다방, 식단꿀팁, 다이어트 일기, 챌린지모집, 다이어트 일기, 다이어트 후기
     

  - 공지사항
  - 공지글 작성 , 수정, 삭제 (관리자만 가능)
    - 사용자가 게시글 조회시 공지사항이 가장 상단에 노출


ERD & API
--
![개인프로젝트 DietCommunity-erd.png](..%2F..%2F..%2FPictures%2F%EA%B0%9C%EC%9D%B8%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%20DietCommunity-erd.png)

https://www.erdcloud.com/d/NGZsS8EKsbdeQsttQ

Tech Stack
--

| 이름 | 적용기능 | 선택이유 |
|--|--|--|
|  |  |  |
|  |  |  |
|  |  |  |


Trouble Shooting
--